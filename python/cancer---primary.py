# Catherine Morgan, Roger T Webb, Mathew J Carr, Evangelos Kontopantelis, Carolyn A Chew-Graham, Nav Kapur, Darren M. Ashcroft, 2024.

import sys, csv, re

codes = [{"code":"1729B","system":"readv2"},{"code":"203 KA","system":"readv2"},{"code":"2102AP","system":"readv2"},{"code":"2029LD","system":"readv2"},{"code":"159","system":"readv2"},{"code":"1530AC","system":"readv2"},{"code":"1991MR","system":"readv2"},{"code":"1820A","system":"readv2"},{"code":"2102A","system":"readv2"},{"code":"2062","system":"readv2"},{"code":"188 RH","system":"readv2"},{"code":"1890BL","system":"readv2"},{"code":"B22z.11","system":"readv2"},{"code":"1891C","system":"readv2"},{"code":"1429C","system":"readv2"},{"code":"1621C","system":"readv2"},{"code":"203","system":"readv2"},{"code":"1709A","system":"readv2"},{"code":"1929EP","system":"readv2"},{"code":"1929AC","system":"readv2"},{"code":"1719H","system":"readv2"},{"code":"2059MB","system":"readv2"},{"code":"1841C","system":"readv2"},{"code":"1959CA","system":"readv2"},{"code":"1519B","system":"readv2"},{"code":"1890CH","system":"readv2"},{"code":"188 TC","system":"readv2"},{"code":"1702P","system":"readv2"},{"code":"159 A","system":"readv2"},{"code":"209 CL","system":"readv2"},{"code":"1719M","system":"readv2"},{"code":"B1z0.11","system":"readv2"},{"code":"2022LK","system":"readv2"},{"code":"1529B","system":"readv2"},{"code":"1942AM","system":"readv2"},{"code":"1609A","system":"readv2"},{"code":"2051","system":"readv2"},{"code":"1560C","system":"readv2"},{"code":"1723A","system":"readv2"},{"code":"2041","system":"readv2"},{"code":"1719F","system":"readv2"},{"code":"1732AC","system":"readv2"},{"code":"1589MP","system":"readv2"},{"code":"174 AN","system":"readv2"},{"code":"1579C","system":"readv2"},{"code":"1879A","system":"readv2"},{"code":"188 A","system":"readv2"},{"code":"208","system":"readv2"},{"code":"1739C","system":"readv2"},{"code":"1560A","system":"readv2"},{"code":"1550BH","system":"readv2"},{"code":"174 PB","system":"readv2"},{"code":"2070BL","system":"readv2"},{"code":"1959DA","system":"readv2"},{"code":"1618A","system":"readv2"},{"code":"203 PL","system":"readv2"},{"code":"180 C","system":"readv2"},{"code":"208 RV","system":"readv2"},{"code":"1739CS","system":"readv2"},{"code":"188 C","system":"readv2"},{"code":"2079PC","system":"readv2"},{"code":"1830AD","system":"readv2"},{"code":"1620A","system":"readv2"},{"code":"1890A","system":"readv2"},{"code":"186 T","system":"readv2"},{"code":"1923","system":"readv2"},{"code":"1529A","system":"readv2"},{"code":"1459C","system":"readv2"},{"code":"1849A","system":"readv2"},{"code":"1719RB","system":"readv2"},{"code":"201","system":"readv2"},{"code":"1878","system":"readv2"},{"code":"1991MC","system":"readv2"},{"code":"1929DG","system":"readv2"},{"code":"1541C","system":"readv2"},{"code":"1709C","system":"readv2"},{"code":"B671.11","system":"readv2"},{"code":"1608A","system":"readv2"},{"code":"2071","system":"readv2"},{"code":"1419C","system":"readv2"},{"code":"2069","system":"readv2"},{"code":"1719FB","system":"readv2"},{"code":"1480C","system":"readv2"},{"code":"1579CL","system":"readv2"},{"code":"1630A","system":"readv2"},{"code":"2104EP","system":"readv2"},{"code":"1409C","system":"readv2"},{"code":"1733AF","system":"readv2"},{"code":"1739A","system":"readv2"},{"code":"1991NC","system":"readv2"},{"code":"2020BR","system":"readv2"},{"code":"191 BC","system":"readv2"},{"code":"1519A","system":"readv2"},{"code":"1739CM","system":"readv2"},{"code":"2070","system":"readv2"},{"code":"1991CR","system":"readv2"},{"code":"1631A","system":"readv2"},{"code":"2061","system":"readv2"},{"code":"147 A","system":"readv2"},{"code":"2051MC","system":"readv2"},{"code":"1550A","system":"readv2"},{"code":"2072AE","system":"readv2"},{"code":"2059MC","system":"readv2"},{"code":"1619A","system":"readv2"},{"code":"1959CF","system":"readv2"},{"code":"186 RC","system":"readv2"},{"code":"2050PM","system":"readv2"},{"code":"149 CT","system":"readv2"},{"code":"191 A","system":"readv2"},{"code":"174 A","system":"readv2"},{"code":"1723C","system":"readv2"},{"code":"1840A","system":"readv2"},{"code":"174 DL","system":"readv2"},{"code":"1841A","system":"readv2"},{"code":"186 TA","system":"readv2"},{"code":"149 A","system":"readv2"},{"code":"1899T","system":"readv2"},{"code":"2022ML","system":"readv2"},{"code":"1870A","system":"readv2"},{"code":"1539A","system":"readv2"},{"code":"1519DA","system":"readv2"},{"code":"144 C","system":"readv2"},{"code":"1519BL","system":"readv2"},{"code":"1529C","system":"readv2"},{"code":"1709AK","system":"readv2"},{"code":"2022CL","system":"readv2"},{"code":"2070MG","system":"readv2"},{"code":"1899C","system":"readv2"},{"code":"203 A","system":"readv2"},{"code":"2079","system":"readv2"},{"code":"186 C","system":"readv2"},{"code":"185 A","system":"readv2"},{"code":"1459A","system":"readv2"},{"code":"2029AL","system":"readv2"},{"code":"2079AL","system":"readv2"},{"code":"1701A","system":"readv2"},{"code":"1719RH","system":"readv2"},{"code":"2059MP","system":"readv2"},{"code":"2022","system":"readv2"},{"code":"1538AD","system":"readv2"},{"code":"1621D","system":"readv2"},{"code":"1719B","system":"readv2"},{"code":"2051GR","system":"readv2"},{"code":"1519L","system":"readv2"},{"code":"1929A","system":"readv2"},{"code":"1830T","system":"readv2"},{"code":"1719LM","system":"readv2"},{"code":"203 T","system":"readv2"},{"code":"1539AT","system":"readv2"},{"code":"1736CN","system":"readv2"},{"code":"1830C","system":"readv2"},{"code":"1943A","system":"readv2"},{"code":"1439A","system":"readv2"},{"code":"1735C","system":"readv2"},{"code":"1600A","system":"readv2"},{"code":"1890MB","system":"readv2"},{"code":"1601AC","system":"readv2"},{"code":"186 CH","system":"readv2"},{"code":"1731AL","system":"readv2"},{"code":"1734AC","system":"readv2"},{"code":"1519CL","system":"readv2"},{"code":"1925NB","system":"readv2"},{"code":"1950A","system":"readv2"},{"code":"2072EL","system":"readv2"},{"code":"1830A","system":"readv2"},{"code":"203 FR","system":"readv2"},{"code":"2021","system":"readv2"},{"code":"1736AN","system":"readv2"},{"code":"185 CA","system":"readv2"},{"code":"2020FR","system":"readv2"},{"code":"1700AM","system":"readv2"},{"code":"1959AE","system":"readv2"},{"code":"2070MC","system":"readv2"},{"code":"1639MA","system":"readv2"},{"code":"1538A","system":"readv2"},{"code":"188 CT","system":"readv2"},{"code":"2020","system":"readv2"},{"code":"1529BL","system":"readv2"},{"code":"1959BD","system":"readv2"},{"code":"1950","system":"readv2"},{"code":"1924NF","system":"readv2"},{"code":"174 DC","system":"readv2"},{"code":"1830AU","system":"readv2"},{"code":"1733AC","system":"readv2"},{"code":"180 A","system":"readv2"},{"code":"208 BL","system":"readv2"},{"code":"2022GR","system":"readv2"},{"code":"174 PN","system":"readv2"},{"code":"1709B","system":"readv2"},{"code":"1621CB","system":"readv2"},{"code":"B10z.11","system":"readv2"},{"code":"1991M","system":"readv2"},{"code":"1533A","system":"readv2"},{"code":"1460A","system":"readv2"},{"code":"1950MA","system":"readv2"},{"code":"186 NT","system":"readv2"},{"code":"1829A","system":"readv2"},{"code":"1419AA","system":"readv2"},{"code":"181 C","system":"readv2"},{"code":"149 C","system":"readv2"},{"code":"193 A","system":"readv2"},{"code":"1991AD","system":"readv2"},{"code":"1579A","system":"readv2"},{"code":"1539C","system":"readv2"},{"code":"2059MR","system":"readv2"},{"code":"209","system":"readv2"},{"code":"1542C","system":"readv2"},{"code":"2001BL","system":"readv2"},{"code":"1890AD","system":"readv2"},{"code":"1550HB","system":"readv2"},{"code":"1829C","system":"readv2"},{"code":"1409A","system":"readv2"},{"code":"1460C","system":"readv2"},{"code":"1991A","system":"readv2"},{"code":"1530CC","system":"readv2"},{"code":"2022BK","system":"readv2"},{"code":"2020FL","system":"readv2"},{"code":"1619C","system":"readv2"},{"code":"174 C","system":"readv2"},{"code":"2050RA","system":"readv2"},{"code":"2102MP","system":"readv2"},{"code":"1992L","system":"readv2"},{"code":"1925GN","system":"readv2"},{"code":"2049AD","system":"readv2"},{"code":"1561C","system":"readv2"},{"code":"186 B","system":"readv2"},{"code":"2104DN","system":"readv2"},{"code":"1922A","system":"readv2"},{"code":"1959AG","system":"readv2"},{"code":"1562C","system":"readv2"},{"code":"1608CM","system":"readv2"},{"code":"188 RC","system":"readv2"},{"code":"186 EM","system":"readv2"},{"code":"2049","system":"readv2"},{"code":"193 C","system":"readv2"},{"code":"190 B","system":"readv2"},{"code":"159 CD","system":"readv2"},{"code":"193 AG","system":"readv2"},{"code":"2020FB","system":"readv2"},{"code":"1550C","system":"readv2"},{"code":"174 CI","system":"readv2"},{"code":"1550BP","system":"readv2"},{"code":"185 C","system":"readv2"},{"code":"1619CV","system":"readv2"},{"code":"1830MC","system":"readv2"},{"code":"186 A","system":"readv2"},{"code":"1735CP","system":"readv2"},{"code":"1929D","system":"readv2"},{"code":"191 MB","system":"readv2"},{"code":"2104AD","system":"readv2"},{"code":"1450C","system":"readv2"},{"code":"1538CN","system":"readv2"},{"code":"1991MT","system":"readv2"},{"code":"186 BL","system":"readv2"},{"code":"1550HC","system":"readv2"},{"code":"2079MK","system":"readv2"},{"code":"1551C","system":"readv2"},{"code":"1520A","system":"readv2"},{"code":"1739B","system":"readv2"},{"code":"203 HC","system":"readv2"},{"code":"1550AP","system":"readv2"},{"code":"2072DG","system":"readv2"},{"code":"1538C","system":"readv2"},{"code":"1929GL","system":"readv2"},{"code":"1538B","system":"readv2"},{"code":"1890NR","system":"readv2"},{"code":"1899A","system":"readv2"},{"code":"1420A","system":"readv2"},{"code":"150 A","system":"readv2"},{"code":"1530AD","system":"readv2"},{"code":"1520B","system":"readv2"},{"code":"1541A","system":"readv2"},{"code":"2050MB","system":"readv2"},{"code":"1519AA","system":"readv2"},{"code":"1419A","system":"readv2"},{"code":"1519C","system":"readv2"},{"code":"1959BA","system":"readv2"},{"code":"1729L","system":"readv2"},{"code":"1890W","system":"readv2"},{"code":"186 TM","system":"readv2"},{"code":"149 AT","system":"readv2"},{"code":"2070MA","system":"readv2"},{"code":"2040","system":"readv2"},{"code":"1929MN","system":"readv2"},{"code":"1621A","system":"readv2"},{"code":"1729","system":"readv2"},{"code":"186 AN","system":"readv2"},{"code":"2050MM","system":"readv2"},{"code":"1892C","system":"readv2"},{"code":"1620C","system":"readv2"},{"code":"1890HM","system":"readv2"},{"code":"150 C","system":"readv2"},{"code":"2060","system":"readv2"},{"code":"2059M","system":"readv2"},{"code":"1959CB","system":"readv2"},{"code":"1703A","system":"readv2"},{"code":"1991C","system":"readv2"},{"code":"1621AB","system":"readv2"},{"code":"1892A","system":"readv2"},{"code":"209 HM","system":"readv2"},{"code":"2029CH","system":"readv2"},{"code":"1569A","system":"readv2"},{"code":"1890C","system":"readv2"},{"code":"1959AA","system":"readv2"},{"code":"1709D","system":"readv2"},{"code":"1719AC","system":"readv2"},{"code":"2059E","system":"readv2"},{"code":"1959BB","system":"readv2"},{"code":"1739BP","system":"readv2"},{"code":"1830TT","system":"readv2"},{"code":"1550B","system":"readv2"},{"code":"203 N","system":"readv2"},{"code":"1610A","system":"readv2"},{"code":"1820C","system":"readv2"},{"code":"1890R","system":"readv2"},{"code":"2001","system":"readv2"},{"code":"1601A","system":"readv2"},{"code":"190 A","system":"readv2"},{"code":"1538AN","system":"readv2"},{"code":"208 CE","system":"readv2"},{"code":"2050","system":"readv2"},{"code":"201 G","system":"readv2"},{"code":"1533AD","system":"readv2"},{"code":"159 C","system":"readv2"},{"code":"2000","system":"readv2"},{"code":"1429B","system":"readv2"},{"code":"1959DB","system":"readv2"}];
REQUIRED_CODES = 1;
with open(sys.argv[1], 'r') as file_in, open('cancer-potential-cases.csv', 'w', newline='') as file_out:
    csv_reader = csv.DictReader(file_in)
    csv_writer = csv.DictWriter(file_out, csv_reader.fieldnames + ["cancer---primary-identified"])
    csv_writer.writeheader();
    codes_identified = 0;
    for row in csv_reader:
        newRow = row.copy();
        for cell in row:
            # Iterate cell lists (e.g. codes)
            for item in re.findall(r'\(([^,]*)\,', row[cell]):
                if(item in list(map(lambda code: code['code'], codes))): codes_identified+=1;
                if(codes_identified>=REQUIRED_CODES):
                    newRow["cancer---primary-identified"] = "CASE";
                    break;
            if(codes_identified>=REQUIRED_CODES): break;
        if(codes_identified<REQUIRED_CODES):
            newRow["cancer---primary-identified"] = "UNK";
        codes_identified=0;
        csv_writer.writerow(newRow)
